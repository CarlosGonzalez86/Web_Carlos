<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Descarga Música en Web_Carlos</title>
    <style>
        /* Estilos existentes */
        /* (No se realizaron cambios significativos en los estilos, ya están bien diseñados) */
    </style>
</head>

<body>
    <h1>Descarga música en mi Web_Carlos</h1>
    <p class="subtitle">Descarga tus canciones favoritas en múltiples formatos con facilidad - ¡rápido y seguro!</p>

    <section id="instructions" aria-label="Instrucciones de uso">
        <strong>Instrucciones de uso:</strong>
        <ul>
            <li>Ingresa la URL directa del archivo de música que deseas descargar.</li>
            <li>Selecciona el formato deseado para la descarga (MP3, WAV, OGG, FLAC, AAC).</li>
            <li>Presiona <em>Descargar música</em> para generar el archivo. En este demo la conversión es simulada.</li>
            <li>Haz clic en el enlace de descarga que aparece para guardar tu canción en el formato elegido.</li>
            <li>Asegúrate de usar URLs válidas con derecho para descargar el contenido.</li>
        </ul>
    </section>

    <main role="main" aria-label="Formulario para descarga de música">
        <label for="musicUrl">URL de la canción</label>
        <input type="url" id="musicUrl" placeholder="Ejemplo: https://example.com/musica.mp3" required autocomplete="off" spellcheck="false" />
        <label for="formatSelect">Selecciona formato de descarga</label>
        <select id="formatSelect" required>
            <option value="">-- Elige un formato --</option>
            <option value="mp3">MP3</option>
            <option value="wav">WAV</option>
            <option value="ogg">OGG</option>
            <option value="flac">FLAC</option>
            <option value="aac">AAC</option>
        </select>
        <button id="downloadBtn" disabled>Descargar música</button>
        <div id="message" role="alert" aria-live="polite"></div>
        <div id="downloadLink" aria-live="polite"></div>
    </main>

    <script>
        (() => {
            // Referencias a elementos del DOM
            const urlInput = document.getElementById('musicUrl');
            const formatSelect = document.getElementById('formatSelect');
            const downloadBtn = document.getElementById('downloadBtn');
            const message = document.getElementById('message');
            const downloadLinkContainer = document.getElementById('downloadLink');

            // Validar si una URL es válida
            function validateUrl(value) {
                try {
                    new URL(value);
                    return true;
                } catch {
                    return false;
                }
            }

            // Actualizar estado del botón y mensajes
            function updateButtonState() {
                const validUrl = validateUrl(urlInput.value.trim());
                const formatChosen = formatSelect.value !== '';
                downloadBtn.disabled = !(validUrl && formatChosen);
                message.textContent = '';
                downloadLinkContainer.innerHTML = '';
            }

            // Simular el proceso de descarga
            async function simulateDownloadProcess(url, format) {
                message.style.color = '#33ffcc';
                message.textContent = 'Preparando la descarga...';

                // Simular validación y conversión
                await new Promise((resolve) => setTimeout(resolve, 1200));
                if (!url.toLowerCase().endsWith(format) && !url.includes('?')) {
                    message.textContent = `El archivo no está en formato .${format}, simulando conversión...`;
                    await new Promise((resolve) => setTimeout(resolve, 1500));
                }
                message.textContent = 'Listo para descargar.';

                // Crear enlace de descarga simulado
                const fakeBlob = new Blob([`Archivo simulado para URL: ${url} en formato: ${format}`], {
                    type: 'audio/' + format,
                });
                const fakeUrl = URL.createObjectURL(fakeBlob);
                downloadLinkContainer.innerHTML = `<a href="${fakeUrl}" download="cancion.${format}">Descargar archivo .${format}</a>`;
                downloadLinkContainer.style.display = 'block';
            }

            // Eventos para actualizar la interfaz
            urlInput.addEventListener('input', updateButtonState);
            formatSelect.addEventListener('change', updateButtonState);

            // Evento de clic en el botón de descarga
            downloadBtn.addEventListener('click', (e) => {
                e.preventDefault();
                message.style.color = '#33ffcc';
                message.textContent = '';
                downloadLinkContainer.innerHTML = '';
                downloadLinkContainer.style.display = 'none';

                const url = urlInput.value.trim();
                const format = formatSelect.value;

                if (!validateUrl(url)) {
                    message.style.color = '#ff4444';
                    message.textContent = 'Por favor, ingresa una URL válida.';
                    return;
                }
                if (!format) {
                    message.style.color = '#ff4444';
                    message.textContent = 'Por favor, selecciona un formato.';
                    return;
                }

                // Simular el proceso de descarga
                simulateDownloadProcess(url, format).catch((err) => {
                    message.style.color = '#ff4444';
                    message.textContent = 'Error durante el proceso.';
                    console.error(err);
                });
            });
        })();
    </script>
</body>

</html>